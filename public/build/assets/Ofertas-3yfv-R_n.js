import{R as i,r as o}from"./FilterContainer-TykbAVkI.js";import{c as N}from"./ReactAppend-GBOQKLDe.js";import{C as S}from"./CreateReactScript-Il069F1S.js";import{F as k,P as j,a as R}from"./ProductCard-EMqdq8Z6.js";import{m as O}from"./SelectAPIFormGroup-A251JnnE.js";import{a as T}from"./arrayJoin-Fk5sgFcM.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-GBzf7Cls.js";import"./CreateReactScript-Hm6EbMAE.js";import"./axios-_sX4vCAy.js";import"./TippyButton-w0wM3ydO.js";const I=({minPrice:d,maxPrice:p,categories:b,tags:y,attribute_values:_,id_cat:f})=>{o.useEffect(()=>{const t=document.createElement("script");return t.src="https://cdn.sode.me/extends/notify.extend.min.js",t.async=!0,document.body.appendChild(t),()=>{document.body.removeChild(t)}},[null]);const c=10,[E,P]=o.useState([]),[e,C]=o.useState(f?{category_id:[f]}:{}),[m,F]=o.useState(0),[n,g]=o.useState(1);o.useEffect(()=>{g(1),h()},[e]),o.useEffect(()=>{h()},[n]);const h=async()=>{const t=[];if((e.maxPrice||e.minPrice)&&(e.maxPrice&&e.minPrice?t.push([[["precio",">=",e.minPrice],"or",["descuento",">=",e.minPrice]],"and",[["precio","<=",e.maxPrice],"or",["descuento","<=",e.maxPrice]]]):e.minPrice?t.push([["precio",">=",e.minPrice],"or",["descuento",">=",e.minPrice]]):e.maxPrice&&t.push([["precio","<=",e.maxPrice],"or",["descuento","<=",e.maxPrice]])),e["txp.tag_id"]&&e["txp.tag_id"].length>0){const r=[];e["txp.tag_id"].forEach((a,s)=>{s==0?r.push(["txp.tag_id","=",a]):r.push("or",["txp.tag_id","=",a])}),t.push(r)}for(const r in e){if(!r.startsWith("attribute-")||e[r].length==0)continue;const[,a]=r.split("-"),s=[];e[r].forEach((x,w)=>{w==0?s.push(["apv.attribute_value_id","=",x]):s.push("or",["apv.attribute_value_id","=",x])}),t.push([["a.id","=",a],"and",s])}if(e.category_id&&e.category_id.length>0){const r=[];e.category_id.forEach((a,s)=>{s==0?r.push(["categoria_id","=",a]):r.push("or",["categoria_id","=",a])}),t.push(r)}if(e.subcategory_id&&e.subcategory_id.length>0){const r=[];e.subcategory_id.forEach((a,s)=>{s==0?r.push(["subcategory_id","=",a]):r.push("or",["subcategory_id","=",a])}),t.push(r)}const{status:l,result:u}=await O.Fetch("/api/ofertas/paginate",{method:"POST",body:JSON.stringify({requireTotalCount:!0,filter:T([...t,["products.visible","=",!0]],"and"),take:c,skip:c*(n-1)})});P((u==null?void 0:u.data)??[]),F((u==null?void 0:u.totalCount)??0)},v=_.reduce((t,l)=>(t[l.attribute_id]||(t[l.attribute_id]=[]),t[l.attribute_id].push(l),t),{});return i.createElement(i.Fragment,null,i.createElement("form",{className:"flex flex-col md:flex-row gap-6  mx-auto font-poppins bg-[#F1F1F1] w-full",style:{padding:"40px"}},i.createElement("section",{className:"flex flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max md:sticky top-2"},i.createElement(k,{setFilter:C,filter:e,minPrice:d??0,maxPrice:p??0,categories:b,tags:y,attribute_values:Object.values(v),selected_category:f})),i.createElement("section",{className:"flex flex-col gap-6 md:basis-9/12"},i.createElement("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3"},i.createElement("div",null,i.createElement("span",{className:"font-normal text-[17px] text-[#666666] ml-3"},"Mostrando ",(n-1)*c+1," - ",n*c>m?m:n*c," de ",m," resultados"))),i.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 pr-4"},E.map((t,l)=>i.createElement(j,{key:`product-${t.id}`,item:t,bgcolor:"bg-white"}))),i.createElement("div",{className:"w-full font-medium flex flex-row justify-center items-center"},i.createElement(R,{current:n,setCurrent:g,pages:Math.ceil(m/c)})))))};S((d,p)=>{N(d).render(i.createElement(I,{...p}))});
